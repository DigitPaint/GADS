!function(){"use strict";Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var a,i=[],o=arguments[1],r=0;r<n;r++){r in t&&(a=t[r],e.call(o,a,r,t)&&i.push(a))}return i}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var a=arguments[1],i=0;i<n;){var o=t[i];if(e.call(a,o,i,t))return o;i++}return undefined}),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e.apply(this,[this[t],t,this])}),Array.prototype.includes||(Array.prototype.includes=function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0==a)return!1;for(var i=0|t,o=Math.max(0<=i?i:a-Math.abs(i),0),r=function r(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)};o<a;){if(r(n[o],e))return!0;o++}return!1}),Array.prototype.map||(Array.prototype.map=function(e){if(null==this)throw TypeError();var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError();var a=[];a.length=n;for(var i=arguments[1],o=0;o<n;o++)o in t&&(a[o]=e.call(i,t[o],o,t));return a}),Array.prototype.some||(Array.prototype.some=function(e,t){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var n=Object(this),a=n.length>>>0,i=0;i<a;i++)if(i in n&&e.call(t,n[i],i,n))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function a(){},i=function i(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n});var t=$.fn.datepicker;$.fn.datepicker=function(){var e=t.apply(this,arguments);return this.on("show",function(){var e=$(this),t=e.data("datepicker").picker,n=t.hasClass("datepicker-orient-top")?e.offset().top-t.outerHeight()-parseInt(t.css("marginTop")):e.offset().top+e.outerHeight()+parseInt(t.css("marginTop"));t.offset({top:n})}),e};var n,a=(n=function n(e){$("a[role=button]",e).on("keypress",function(e){32===e.keyCode&&this.click()});var i=$(".navbar-fixed-bottom",e);i.length&&$(".edit-form .form-group",e).on("focusin",function(e){var t=$(e.target),n=t.offset().top+t.outerHeight(),a=i.offset().top;a<n&&$("html, body").animate({scrollTop:$(window).scrollTop()+n-a+20},300)})},function(e){n(e)});function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function i(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?l(Object(o),!0).forEach(function(e){var t,n,a;t=i,a=o[n=e],n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})}return i}var o,c,d,s,u,f,p,h,m,v,g,b,y,w,j,k,T,x,C,O,A,D,L,S,q,R,E,P,N,I,F,B,J,M,H,z,G,U,W,V,Q,Z,K,Y,X,ee,te,ne,ae,ie,oe,re,le,ce,de,se,ue,fe,pe,he,me=(o=function o(e){if(!["date","daterange"].includes(e))return undefined;var t=["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_empty","is_not_empty"];return"daterange"===e&&t.push("contain"),t},c=function c(a,i,o){return{input:function(e,t,n){return'<input class="typeahead_text" type="text" name="'.concat(n,'_text">\n      <input class="typeahead_hidden" type="hidden" name="').concat(n,'"></input>')},valueSetter:function(e,t,n,a,i){e.find(".typeahead_text").val(i.text),e.find(".typeahead_hidden").val(t)},onAfterCreateRuleInput:function(e){var t=$("#".concat(e.attr("id"),' .rule-value-container input[type="text"]')),n=$("#".concat(e.attr("id"),' .rule-value-container input[type="hidden"]'));t.attr("autocomplete","off"),t.typeahead({delay:100,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){"object"===r(e)?n.val(e.id):n.val(e)},source:function(e,t){return $.ajax({type:"GET",url:"/".concat(i,"/match/layout/").concat(a),data:{q:e,oi:o},success:function(e){t(e)},dataType:"json"})}})}}},f=[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["datetime","string"]},{type:"not_contains",accept_values:!0,apply_to:["datetime","string"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!(u=function u(){window.UpdateFilter=function(e){var t=e.queryBuilder("getRules");$("#filter").val(JSON.stringify(t,null,2))}}),apply_to:["string","number","datetime"]},{type:"is_not_empty",accept_values:!(s=function s(e,t){return i({id:t.filterId,label:t.label,type:"string",operators:o(t.type)},"rag"===t.type?d:t.hasFilterTypeahead?c(t.urlSuffix,e.layoutId,t.instanceId):{})}),apply_to:["string","number","datetime"]},{type:"changed_after",nb_inputs:1,accept_values:!0,multiple:!(d={input:"select",values:{b_red:"Red",c_amber:"Amber",c_yellow:"Yellow",d_green:"Green",a_grey:"Grey",e_purple:"Purple"}}),apply_to:["string","number","datetime"]}],p=function p(e){var t=JSON.parse($(e).html());t.filterNotDone&&u(),$("#builder".concat(t.builderId)).queryBuilder({showPreviousValues:t.showPreviousValues,filters:t.filters.map(function(e){return s(t,e)}),operators:f,lang:{operators:{changed_after:"changed on or after"}}})},h=function h(e){$('script[id^="builder_json_"]',e).each(function(e,t){p(t)})},m=function m(e){$(document,e).on("input",".typeahead_text",function(){var e=$(this).val();$(this).next(".typeahead_hidden").val(e)})},function(e){h(e),m(e)}),ve=function ve(){window.FontDetect&&(FontDetect.isFontLoaded("14px/1 FontAwesome")||($(".use-icon-font").hide(),$(".use-icon-png").show()))},ge=(v=function v(e){var t=$("#calendar",e);if(!t.length)return!1;var n={events_source:"/".concat(t.attr("data-event-source"),"/data_calendar/").concat((new Date).getTime()),view:t.data("view"),tmpl_path:"/tmpls/",tmpl_cache:!1,onAfterEventsLoad:function(e){var n;e&&((n=$("#eventlist")).html(""),$.each(e,function(e,t){$(document.createElement("li")).html('<a href="'.concat(t.url,'">').concat(t.title,"</a>")).appendTo(n)}))},onAfterViewLoad:function(e){$("#caltitle").text(this.getTitle()),$(".btn-group button").removeClass("active"),$('button[data-calendar-view="'.concat(e,'"]')).addClass("active")},classes:{months:{general:"label"}}},a=t.data("calendar-day-ymd");return a&&(n.day=a),t.calendar(n)},g=function g(t,e){$(".btn-group button[data-calendar-nav]",e).each(function(){var e=$(this);e.click(function(){t.navigate(e.data("calendar-nav"))})}),$(".btn-group button[data-calendar-view]",e).each(function(){var e=$(this);e.click(function(){t.view(e.data("calendar-view"))})})},b=function b(t,e){$("#first_day",e).change(function(){var e=(e=$(this).val()).length?parseInt(e):null;t.setOptions({first_day:e}),t.view()}),$("#language",e).change(function(){t.setLanguage($(this).val()),t.view()}),$("#events-in-modal",e).change(function(){var e=$(this).is(":checked")?$(this).val():null;t.setOptions({modal:e})}),$("#events-modal .modal-header, #events-modal .modal-footer",e).click(function(){})},function(e){var t=v(e);t&&(g(t,e),b(t,e),ve())}),$e=(y=function y(t){return t=t||{},_.chain(location.search.slice(1).split("&")).map(function(e){return e?e.split("="):undefined}).compact().value().filter(function(e){return e[0]!==t.except})},w=function w(e){$(".column-filter",e).each(function(){var e=$(this),a=e.data("col-id"),t=e.data("autocomplete-endpoint"),n=e.data("autocomplete-has-id"),i=e.data("values")||[],o=e.find(".column-filter__error"),r=e.find(".column-filter__search-input"),l=e.find(".column-filter__clear-search-input"),c=e.find(".column-filter__spinner"),d=e.find(".column-filter__values"),s=e.find(".column-filter__submit"),u=function u(){return r.length?r.val():""},f=function f(){return 1===r.length},p=function p(e,t){var n="column_filter_value_label_"+a+"_"+t;return $('<li class="column-filter__value"><label id="'+n+'_label" for="'+n+'"><input id="'+n+'" type="checkbox" value="'+e.id+'" '+(e.checked?"checked":"")+' aria-labelledby="'+n+'_label"><span role="option">'+e.value+"</span></label></li>")},h=function h(){var t=u();d.empty();var e=_.filter(i,function(e){return-1<e.value.toLowerCase().indexOf(t.toLowerCase())}),n=f()?_.sortBy(e,"value"):e;_.each(n,function(e,t){d.append(p(e,t))})},m=function m(){o.attr("hidden",""),h()},v=_.debounce(function(){var e=u();e.length?(o.attr("hidden",""),c.removeAttr("hidden"),$.getJSON(t+e,function(e){_.each(e,function(t){n?_.some(i,function(e){return e.id===t.id.toString()})||i.push({id:t.id.toString(),value:t.name}):i.push({value:t})})}).fail(function(e,t,n){o.text(n),o.removeAttr("hidden")}).always(function(){c.attr("hidden",""),h()})):m()},250);d.delegate("input","change",function(){var t=$(this).val(),e=_.findIndex(i,function(e){return e.id===t});i[e].checked=this.checked}),r.on("keyup",function(){$(this).val().length?l.removeAttr("hidden"):l.attr("hidden","")});var g=function g(e){return"undefined"==typeof e[1]?e[0]:e[0]+"="+e[1]};n?(r.on("keyup",v),s.on("click",function(){var e=_.map(_.filter(i,"checked"),"id"),t=y({except:"field"+a});e.forEach(function(e){t.push(["field"+a,e])}),window.location="?"+t.map(function(e){return g(e)}).join("&")})):(r.on("keypress",function(e){13===e.keyCode&&(e.preventDefault(),s.trigger("click"))}),s.on("click",function(){var e=y({except:"field"+a});e.push(["field"+a,u()]),window.location="?"+e.map(function(e){return g(e)}).join("&")})),l.on("click",function(e){e.preventDefault(),r.val(""),l.attr("hidden",""),m()}),h()})},function(e){w(e)}),be=function be(e,t,n){var a,i=t+"px",o=e+n+"px";this.css({left:i,top:o}),document.body&&document.body.clientWidth&&this.get(0).getBoundingClientRect&&((a=document.body.clientWidth-this.get(0).getBoundingClientRect().right)<0&&this.css({left:t+a+"px"}))},ye=function ye(e,t,n,a){t.attr("aria-expanded",n),t.toggleClass("expanded--permanent",n&&a);var i=t.data("label-expanded"),o=t.data("label-collapsed");o&&i&&t.html(n?i:o);var r,l,c,d,s,u=t.siblings(".expandable").first();u.toggleClass("expanded",n),u.hasClass("popover")&&(l=(r=t.offset()).top,c=r.left,(d=t.offsetParent())&&(l-=(s=d.offset()).top,c-=s.left),be.call(u,l,c,t.outerHeight()+6)),t.trigger(n?"expand":"collapse",u),e.stopPropagation()},_e=function _e(e){var t=$(this),n=t.hasClass("expanded--permanent");ye(e,t,!n,!0)},we=function we(e){var t=$(this);"true"===t.attr("aria-expanded")||ye(e,t,!0,!1)},ke=function ke(e){var t=$(this),n="true"===t.attr("aria-expanded"),a=t.hasClass("expanded--permanent");n&&!a&&ye(e,t,!1,!1)},xe=function xe(e){$(".trigger[aria-expanded]",e).on("click",_e),$(".trigger[aria-expanded][data-expand-on-hover=true]",e).on("mouseover",we),$(".trigger[aria-expanded][data-expand-on-hover=true]",e).on("mouseout",ke)},Te=(j=function j(e){var s=this,o=this.find(".form-control"),r=o.find("[aria-expanded]"),u=this.find(".current"),f=this.find(".available"),p=this.find(".available .answer input"),h=this.find(".available .answer .more-info"),l=this.find("#"+r.attr("aria-controls")),m=u.find("[data-list-item]"),v=this.find(".answer"),n=null,g=this.find(".form-control-search"),b=null,c=function c(e,t,n){s.removeClass("select-widget--open"),t.attr("aria-expanded",!1),setTimeout(function(){g.val(""),n.attr("hidden",""),v.removeAttr("hidden")},50)},y=function y(){var e=u.children("[data-list-item]:not([hidden])");u.toggleClass("empty",0===e.length),o.trigger("change")},_=function _(e){var t=e.relatedTarget||document.activeElement;s.find(t).length||!t||$(t).is(".modal, .page")||s.get(0).parentNode===t||c(o,r,l)},t=function t(n){return function(){var t=$(this),e=t.data("list-item"),o=$("#"+e);o.unbind("change"),o.on("change",function(e){e.stopPropagation(),$(this).prop("checked")?t.removeAttr("hidden"):t.attr("hidden",""),n()}),o.unbind("keydown"),o.on("keydown",function(e){var t=e.which||e.keyCode;switch(t){case 38:case 40:var n,a=f.find(".answer:not([hidden])"),i=a.index(o.closest(".answer"));e.preventDefault(),(n=38===t?a[i-1]:a[i+1])&&$(n).find("input").focus();break;case 13:e.preventDefault(),$(this).trigger("click")}})}},a=function a(){m.each(function(e,t){var n=$(t),a=n.data("list-item"),i=$("#"+a);i.unbind("click"),i.on("click",function(e){e.stopPropagation()}),i.parent().unbind("keypress"),i.parent().on("keypress",function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),$(this).trigger("click"))}),i.parent().unbind("click"),i.parent().on("click",function(e){e.stopPropagation(),m.each(function(){$(this).attr("hidden","")}),u.toggleClass("empty",!1),n.removeAttr("hidden"),o.trigger("change"),c(o,r,l)})})},w=function w(){e?m.each(t(y)):a()},k=function k(e,t,n,a,i){return e&&!n?$('<li class="none-selected">blank</li>'):$("<li "+(i?"":"hidden")+' data-list-item="'+(n?t+"_"+n:t+"__blank")+'" data-list-text="'+a+'" class="'+(n?"":"current__blank")+'"><span class="widget-value__value">'+a+"</span>"+(e?'<button type="button" class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"")+"</li>")},x=function x(e,t,n,a,i){if(e&&!n)return null;var o=n?t+"_"+n:t+"__blank";return $('<li class="'+(n?"answer":"answer answer--blank")+'"><span class="control"><label id="'+o+'_label" for="'+o+'"><input id="'+o+'" type="'+(e?"checkbox":"radio")+'" name="'+t+'" '+(i?"checked":"")+' value="'+(n||"")+'" class="'+(e?"":"visually-hidden")+'" aria-labelledby="'+o+'_label"><span role="option">'+a+"</span></label></span>"+(n?'<span class="details"><button type="button" class="more-info" data-record-id="'+n+'" aria-describedby="'+o+'_label" aria-haspopup="listbox">Details</button></span>':"")+"</li>")},T=function T(){var i=s.data("field"),o=s.hasClass("multi"),r=s.data("filter-endpoint"),e=s.data("filter-fields"),t=s.data("submission-token");$.isArray(e)||Linkspace.error("Invalid data-filter-fields found. It should be a proper JSON array of fields.");var l=f.find("input:checked").map(function(){return parseInt($(this).val())}).get(),c=["submission-token="+t];$.each(e,function(e,a){$("input[name="+a+"]").each(function(e,t){var n=$(t);switch(n.attr("type")){case"text":c.push(a+"="+n.val());break;case"radio":case"checkbox":t.checked&&c.push(a+"="+n.val());break;case"hidden":c.push(a+"="+n.val())}})});var d=c.join("&");b!==d&&(b=null,f.find(".answer").remove(),f.find(".spinner").removeAttr("hidden"),$.getJSON(r+"?"+d,function(e){var t,n,a;m.remove(),0===e.error?(t=l.includes(NaN),g.parent().prev(".none-selected").remove(),g.parent().before(k(o,i,null,"blank",t)),f.append(x(o,i,null,"blank",t)),$.each(e.records,function(e,t){var n=l.includes(t.id);g.parent().before(k(o,i,t.id,t.label,n)),f.append(x(o,i,t.id,t.label,n))}),m=u.find("[data-list-item]"),f=s.find(".available"),p=s.find(".available .answer input"),h=s.find(".available .answer .more-info"),v=s.find(".answer"),y(),w(),p.on("blur",_),h.on("blur",_),b=d):(n=1===e.error?e.message:"Oops! Something went wrong.",a=$('<li class="answer answer--blank alert alert-danger"><span class="control"><label>'+n+"</label></span></li>"),f.append(a))}).fail(function(e,t,n){Linkspace.error("Failed to make request to "+r+": "+t+": "+n);var a=$('<li class="answer answer--blank alert alert-danger"><span class="control"><label>Oops! Something went wrong.</label></span></li>');f.append(a)}).always(function(){f.find(".spinner").attr("hidden","")}))},d=function d(e,t,n){var a,i,o,r,l;"true"!==t.attr("aria-expanded")&&(s.addClass("select-widget--open"),t.attr("aria-expanded",!0),s.data("filter-endpoint")&&s.data("filter-endpoint").length&&T(),i=(a=e.offset().top)+e.outerHeight(),r=(o=$(window).scrollTop())+$(window).height()-60,l=o<a-200&&!(i+200<r),n.toggleClass("available--top",l),n.removeAttr("hidden"),g.get(0)!==document.activeElement&&g.focus())};y(),w(),o.unbind("click"),o.on("click",function(){("true"===r.attr("aria-expanded")?c:d)(o,r,l)}),g.unbind("blur"),g.on("blur",_),p.unbind("blur"),p.on("blur",_),h.unbind("blur"),h.on("blur",_),$(document).on("click",function(e){var t=!this.is(e.target)&&0===this.has(e.target).length,n=0!==$(e.target).closest(".modal").length;t&&!n&&c(o,r,l)}.bind(this)),$(document).keyup(function(e){27==e.keyCode&&c(o,r,l)});var i=function i(e){e.stopPropagation(),d(o,r,l)};o.delegate(".select-widget-value__delete","click",function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentElement.getAttribute("data-list-item"),n=document.querySelector("#"+t);n.checked=!1,$(n).trigger("change")}),g.unbind("focus",i),g.on("focus",i),g.unbind("keydown"),g.on("keydown",function(e){var t=e.which||e.keyCode;switch(t){case 38:case 40:var n,a=f.find(".answer:not([hidden]) input");e.preventDefault(),(n=38===t?a[a.length-1]:a[0])&&$(n).focus();break;case 13:e.preventDefault();var i=f.find(".answer:not([hidden]) input").get(0);i&&$(i).parent().trigger("click")}}),g.unbind("keyup"),g.on("keyup",function(){var e=$(this).val().toLowerCase();(n=n||$("<span>").addClass("form-control-search").css("white-space","nowrap")).text(e),g.css("width",n.insertAfter(g).width()+70),n.detach();var t=!1;$.each(v,function(){-1===$(this).find("label")[0].innerHTML.toLowerCase().indexOf(e)?$(this).attr("hidden",""):(t=!0,$(this).removeAttr("hidden",""))}),t?f.find(".has-noresults").attr("hidden",""):f.find(".has-noresults").removeAttr("hidden","")}),g.unbind("click"),g.on("click",function(e){e.stopPropagation()})},k=function k(e){$(".select-widget",e).each(function(){var e=$(this).hasClass("multi");j.call($(this),e)})},function(e){k(e)}),je=function je(e,t){if(0==e.length||"none"==e.css("display"))return[""];var n=e.data("column-type"),a=[];return"enum"===n||"curval"===n?t?e.find(".select-widget .available .answer").each(function(){var e=$(this).find('[role="option"]');a.push(e.text())}):e.find(".select-widget .current [data-list-item]:not([hidden])").each(function(){var e=$(this).hasClass("current__blank")?"":$(this).data("list-text");a.push(e)}):"person"===n?a=[e.find("option:selected").text()]:"tree"===n?e.find(".selected-tree-value").each(function(){a.push($(this).data("text-value"))}):a="daterange"===n?e.find(".form-control").map(function(){return $(this).val()}).get().join(" to "):[e.find(".form-control").val()],0==a.length&&(a=[""]),a},Ce=function Ce(){var e=function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Oe=(T=function T(a,i,o){var r,e,t,n,l,c,d,s,u,f,p,h,m,v=a.serialize(),g=a.data("modal-field-ids"),b=a.data("curval-id"),y=a.data("instance-name"),_=a.data("guid"),w=$("<input>",o).attr({type:"hidden",name:"field"+b,value:v}),k=$("div[data-column-id="+b+"]",o),x=k.data("value-selector");"noshow"===x?(r=$('<tr class="curval_item">',o),jQuery.map(g,function(e){var t=a.find('[data-column-id="'+e+'"]'),n=je(t),n=i["field"+e];n=$("<div />",o).text(n).html(),r.append($('<td class="curval-inner-text">',o).append(n))}),e=$('<td>\n        <a class="curval-modal" style="cursor:pointer" data-layout-id="'.concat(b," data-instance-name=").concat(y,'>edit</a> | <a class="curval_remove" style="cursor:pointer">remove</a>\n      </td>'),o),r.append(e.append(w)),_?$('input[data-guid="'+_+'"]',o).val(v).closest(".curval_item").replaceWith(r):$("#curval_list_".concat(b),o).find("tbody").prepend(r)):"dropdown"===x?(t=k.find(".select-widget").first().hasClass("multi"),n=k.find(".current [data-list-item]"),l=k.find(".current .search"),c=k.find(".available"),t||(n.attr("hidden",""),c.find("li input").prop("checked",!1)),d=jQuery.map(g,function(e){var t=i["field"+e];return $("<div />").text(t).html()}).join(", "),_=Ce(),s="field".concat(b,"_").concat(_),u=t?'<button class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"",l.before('<li data-list-item="'.concat(s,'">').concat(d).concat(u,"</li>")),f=t?"checkbox":"radio",c.append('<li class="answer">\n        <span class="control">\n            <label id="'.concat(s,'_label" for="').concat(s,'">\n                <input id="').concat(s,'" name="field').concat(b,'" type="').concat(f,'" value="').concat(v,'" class="').concat(t?"":"visually-hidden",'" checked aria-labelledby="').concat(s,'_label">\n                <span>').concat(d,'</span>\n            </label>\n        </span>\n        <span class="details">\n            <a class="curval_remove" style="cursor:pointer">remove</a>\n        </span>\n      </li>')),Te(k)):"typeahead"===x&&(p=k.find("input[name=field".concat(b,"]")),h=k.find("input[name=field".concat(b,"_typeahead]")),m=jQuery.map(g,function(e){var t=i["field"+e];return $("<div />").text(t).html()}).join(", "),p.val(v),h.val(m)),$(".modal.in",o).modal("hide")},x=function x(e,t){e.find(".alert").text(t).removeAttr("hidden"),e.parents(".modal-content").get(0).scrollIntoView(),e.find("button[type=submit]").prop("disabled",!1)},C=function C(s){$(document,s).on("mousedown",".curval-modal",function(e){var t,n=$(e.target).data("layout-id"),a=$(e.target).data("instance-name"),i=$(e.target).data("current-id"),o=$(e.target).closest(".curval_item").find("input[name=field".concat(n,"]")),r=o.val(),l=o.length?"edit":"add";"edit"==l&&((t=o.data("guid"))||(t=Ce(),o.attr("data-guid",t)));var c=$("#curval_modal",s);c.find(".modal-body").text("Loading...");var d=i?"/record/".concat(i):"/".concat(a,"/record/");c.find(".modal-body").load("".concat(d,"?include_draft&modal=").concat(n,"&").concat(r),function(){"edit"==l&&c.find("form").data("guid",t),Linkspace.init(c)}),c.on("focus",".datepicker",function(){$(this).datepicker({format:c.attr("data-dateformat-datepicker"),autoclose:!0})}),c.modal()})},O=function O(e){$("#curval_modal",e).on("submit",".curval-edit-form",function(e){e.preventDefault();var i=$(this),t=i.serialize();i.addClass("edit-form--validating"),i.find(".alert").attr("hidden",""),$.post(i.attr("action")+"?validate&include_draft",t,function(e){var t;0===e.error?T(i,e.values):(t=1===e.error?e.message:"Oops! Something went wrong.",x(i,t))},"json").fail(function(e,t,n){var a="Oops! Something went wrong: ".concat(t,": ").concat(n);x(i,a)}).always(function(){i.removeClass("edit-form--validating")})})},A=function A(e){$(".curval_group",e).on("click",".curval_remove",function(){$(this).closest(".curval_item").remove()}),$(".select-widget",e).on("click",".curval_remove",function(){var e=$(this).closest(".answer").find("input").prop("id");$(this).closest(".select-widget").find(".current li[data-list-item=".concat(e,"]")).remove(),$(this).closest(".answer").remove()})},function(e){C(e),O(e),A(e)}),Ae=(D=function D(e){$(".datepicker",e).datepicker({format:$(document.body).data("config-dataformat-datepicker"),autoclose:!0})},L=function L(e){$(".input-daterange input.from",e).each(function(){$(this).on("changeDate",function(){var e=$(this).parents(".input-daterange").find(".datepicker.to");e.val()||e.datepicker("update",$(this).datepicker("getDate"))})})},S=function S(e){$(document,e).on("click",".remove_datepicker",function(){var e=".datepicker"+$(this).data("field");$(e).datepicker("destroy"),alert("Date selector has been disabled for this field")})},function(e){D(e),L(e),S(e)}),De=(q=function q(e){$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".input_holder"),t=e.clone();t.removeAttr("id").insertAfter(e),t.find(":text").val(""),t.find(".datepicker").datepicker({format:e.attr("data-dateformat-datepicker"),autoclose:!0})}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".input_holder");0<e.siblings(".input_holder").length&&e.remove()})},R=function R(a){$("#helptext_modal",a).on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("load-url");$(this).find(".modal-body").load(t)}),$(document,a).on("click",".more-info",function(t){var e=$(t.target).data("record-id"),n=$("#readmore_modal",a);n.find(".modal-body").text("Loading..."),n.find(".modal-body").load("/record_body/"+e),n.one("show.bs.modal",function(e){e.isDefaultPrevented()||n.one("hidden.bs.modal",function(){$(t.target,a).is(":visible")&&$(t.target,a).trigger("focus")})}),n.one("keyup",function(e){27==e.keyCode&&e.stopPropagation()}),n.modal()})},E=function E(a){$('input[type="text"][id^="typeahead_"]',a).each(function(e,n){$(n,a).change(function(){$(this).val()||$("#".concat(n.id,"_value"),a).val("")}),$(n,a).typeahead({delay:500,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){$("#".concat(n.id,"_value"),a).val(e.id)},source:function(e,t){return $.ajax({type:"GET",url:"/".concat($(n,a).data("layout-id"),"/match/layout/").concat($(n).data("typeahead-id")),data:{q:e},success:function(e){t(e)},dataType:"json"})}})})},function(e){q(e),R(e),Oe(e),Ae(e),E(e)}),Le=(P=function P(e){$(".fileupload",e).each(function(){var o=$(this),r=o.find("ul"),e=o.data("fileupload-url"),l=o.data("field"),t=o.find(".progress-bar__container"),a=o.find(".progress-bar__progress"),i=o.find(".progress-bar__percentage");o.fileupload({dataType:"json",url:e,paramName:"file",submit:function(){t.css("display","block"),i.html("0%"),a.css("width","0%")},progress:function(e,t){var n;o.data("multivalue")||(n=Math.round(t.loaded/t.total*1e4)/100+"%",i.html(n),a.css("width",n))},progressall:function(e,t){var n;o.data("multivalue")&&(n=Math.round(t.loaded/t.total*1e4)/100+"%",i.html(n),a.css("width",n))},done:function(e,t){o.data("multivalue")||r.empty();var n=t.result.url.split("/").pop(),a=t.files[0].name,i=$('<li class="help-block"><input type="checkbox" name="'+l+'" value="'+n+'" aria-label="'+a+'" checked>Include file. Current file name: <a href="/file/'+n+'">'+a+"</a>.</li>");r.append(i)}})})},function(e){P(e)}),Se=(N=function N(e){$(".edit-form *:input[type!=hidden]:first",e).focus()},function(e){N(e)}),qe=(I=function I(e){var t,n,a=$("#globe",e);a.length&&(Plotly.setPlotConfig({locale:"en-GB"}),t=JSON.parse(base64.decode(a.attr("data-globe"))),n={showLink:!{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"],topojsonURL:"".concat(a.attr("data-url"),"/")},Plotly.newPlot("globe",t,{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},n))},function(e){I(e)}),Re=(F=function F(e){Plotly.setPlotConfig({locale:"en-GB"});var o=JSON.parse(base64.decode(e.data("globe-data"))),t=o.data,n={showLink:!1,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"],topojsonURL:e.data("topojsonurl")};Plotly.newPlot(e.get(0),t,{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},n).then(function(e){e.on("plotly_click",function(e){var t,n,a,i;e.event.defaultPrevented||(t=(e.points||[])[0],a=(n=o.params).globe_fields.map(function(e){return e+"="+t.location}).join("&"),i="/"+n.layout_identifier+"/data?viewtype=table&view="+n.view_id+"&"+a,n.default_view_limit_extra_id&&(i=i+"&extra="+n.default_view_limit_extra_id),location.href=i)})})},function(e){F(e)}),Ee=(B=function B(e,t){var n;e.type.includes("image")?((n=new FormData).append("file",e),n.append("csrf_token",$("body").data("csrf-token")),$.ajax({url:"/file?ajax&is_independent",type:"POST",contentType:!1,cache:!1,processData:!1,dataType:"JSON",data:n,success:function(e){e.is_ok?$(t).summernote("editor.insertImage",e.url):Linkspace.debug(e.error)}}).fail(function(e){Linkspace.debug(e)})):Linkspace.debug("The type of file uploaded was not an image")},J=function J(e){$.summernote&&$(".summernote",e).summernote({dialogsInBody:!0,height:400,callbacks:{onInit:function(){var e=$(this).siblings("input[type=hidden].summernote_content");$(this).summernote("code",e.val())},onImageUpload:function(e){for(var t=0;t<e.length;t++)B(e[t],this)},onChange:function(e){var t=$(this).closest(".summernote");t.summernote("isEmpty")&&(e=""),t.siblings("input[type=hidden].summernote_content").val(e)}}})},function(e){J(e)}),Pe=(M=function M(n){var a=function a(){var e=$("#jstree_demo_div",n).jstree(!0),t=e.get_selected();if(!t.length)return!1;e.delete_node(t)};$("#btnDeleteNode",n).click(a);var i=function i(){var e=$("#jstree_demo_div",n).jstree(!0),t=(t=e.get_selected()).length?t[0]:"#";(t=e.create_node(t,{type:"file"}))&&e.edit(t)};$("#btnAddNode",n).click(i);var o=function o(){var e=$("#jstree_demo_div",n).jstree(!0),t=e.get_selected();if(!t.length)return!1;t=t[0],e.edit(t)};$("#btnRenameNode",n).click(o)},H=function H(e){$("#selectall",e).click(function(){7==$(".check_perm:checked",e).length?$(".check_perm",e).prop("checked",!1):$(".check_perm",e).prop("checked",!0)})},z=function z(e){$(".sortable",e).length&&$(".sortable",e).sortable({handle:".drag"})},G=function G(e){var t=$("#jstree_demo_div",e);t.length&&t.jstree({core:{check_callback:!0,force_text:!0,themes:{stripes:!0},data:{url:function(){return"/".concat(t.data("layout-identifier"),"/tree").concat((new Date).getTime(),"/").concat(t.data("column-id"),"?")},data:function(e){return{id:e.id}}}}})},U=function U(t){$("div#legs",t).on("click",".add",function(e){$(e.currentTarget,t).closest("#legs").find(".sortable").append('\n          <div class="request-row">\n            <p>\n              <input type="hidden" name="enumval_id">\n              <input type="text" class="form-control" style="width:80%; display:inline" name="enumval">\n              <button type="button" class="close closeme" style="float:none">&times;</button>\n              <span class="fa fa-hand-paper-o fa-lg use-icon-font close drag" style="float:none"></span>\n            </p>\n          </div>\n      '),$(".sortable",t).sortable("refresh")}),$("div#legs").on("click",".closeme",function(e){$(".request-row",t).length<2||$(e.currentTarget,t).parents(".request-row").remove()})},W=function W(n){$("#refers_to_instance_id",n).change(function(e){var t="#instance_fields_".concat($(e.currentTarget,n).val());$(".instance_fields",n).hide(),$(t,n).show()})},V=function V(n){$("#related_field_id",n).change(function(e){var t=$(e.currentTarget).find(":selected").data("instance_id");$(".autocur_instance",n).hide(),$("#autocur_instance_".concat(t),n).show()}),$("#filval_related_field_id",n).change(function(){var e=$(this).val();$(".filval_curval",n).hide(),$("#filval_curval_"+e,n).show()})},Q=function Q(e){$('div[id^="builder"]',e).each(function(e,t){var n,a=$(t).data("filter-base");a&&(n=base64.decode(a),$(t).queryBuilder("setRules",JSON.parse(n)))})},Z=function Z(e){var t,n,a=$("#displayConditionsBuilder",e);a.length&&(t=a.data(),a.queryBuilder({filters:t.filters,allow_groups:0,operators:[{type:"equal",accept_values:!0,apply_to:["string"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"not_equal",accept_values:!0,apply_to:["string"]},{type:"not_contains",accept_values:!0,apply_to:["string"]}]}),t.filterBase&&(n=base64.decode(t.filterBase),a.queryBuilder("setRules",JSON.parse(n))))},K=function K(r){$("#submit_save",r).click(function(){var e=$("#displayConditionsBuilder",r).queryBuilder("getRules");$("#displayConditions",r).val(JSON.stringify(e,null,2));var t="#builder".concat($("#refers_to_instance_id",r).val()),n=$("#jstree_demo_div",r);if(n.length&&n.is(":visible")){var a=n.jstree(!0).get_json("#",{flat:!1}),i=JSON.stringify(a),o=n.data();return $.ajax({async:!1,type:"POST",url:"/".concat(o.layoutIdentifier,"/tree/").concat(o.columnId),data:{data:i,csrf_token:o.csrfToken}}).done(function(){alert("Tree has been updated")}),!0}return $(t,r).is(":visible")&&UpdateFilter($(t,r)),!0})},Y=function Y(a){$("#type",a).on("change",function(){var e=$("#manage-fields",a),t=e.data("column-type"),n=$(this).val();e.removeClass("column-type-"+t),e.addClass("column-type-"+n),e.data("column-type",n),"rag"==n||"intgr"==n||"person"==n?$("#checkbox-multivalue",a).hide():$("#checkbox-multivalue",a).show()}).trigger("change")},X=function X(e){$("#notify_on_selection",e).on("change",function(){$(this).prop("checked")?$("#notify-options",e).show():$("#notify-options",e).hide()}).trigger("change")},function(e){M(e),H(e),z(e),G(e),U(e),W(e),V(e),Q(e),Z(e),K(e),Y(e),X(e)}),Ne=(ee=function ee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},te=function te(e){if("none"==e.css("display"))return e;var t=e.parent();return t&&t.length?te(t):undefined},ne=function ne(e){if(e.attr("data-actual-height"))return e.attr("data-actual-height");if(e.height())return e.height();var a=te(e);if(a){a.find(".more-less").each(function(){$(this).addClass("more-less-id-"+ee())});var t=a.clone().attr("id",!1).css({visibility:"hidden",display:"block",position:"absolute"});return $("body").append(t),t.find(".more-less").each(function(){var n=$(this),e=n.attr("class").split(/\s+/);$.each(e,function(e,t){0<=t.indexOf("more-less-id")&&a.find("."+t).attr("data-actual-height",n.height())})}),t.remove(),e.attr("data-actual-height")}},ae=function ae(e){var i=function i(){var l,e,t,c=$(this),n=c.data("column"),a=c.html();c.removeClass("transparent"),ne(c)<100||(c.addClass("clipped"),l=$("<div/>",{"class":"expandable popover column-content",html:a}),e="Show "+n+" &rarr;",(t=$("<button/>",{"class":"btn btn-xs btn-primary trigger",html:e,type:"button","aria-expanded":!1,"data-expand-on-hover":!0,"data-label-expanded":"Hide "+n,"data-label-collapsed":e})).on("toggle",function(e,t){var n=$(window).width(),a=l.offset().left,i=c.width(),o=400<i?i:400;if("expanded"===t){if(l.css("width",o+"px"),a+o+20<n)return;var r=n-(a+o+20);l.css("left",a+r+"px")}}),c.empty().append(t).append(l),xe(c),l.find(".more-less").each(i))};$(".more-less",e).each(i)},function(e){ae(e)}),Ie=(ie=function ie(e,t){var n=$(e,t);n.data("open-on-load")&&n.modal("show")},function(e){ie("#modalregister",e),ie("#modal-reset-password",e)}),Fe=(oe=function oe(r){var e=$("#modal_metric",r);e.length&&e.on("show.bs.modal",function(e){var t=$(e.relatedTarget),n=t.data("metric_id");$("#metric_id",r).val(n),n?$("#delete_metric",r).show():$("#delete_metric",r).hide();var a=t.data("target_value");$("#target_value",r).val(a);var i=t.data("x_axis_value");$("#x_axis_value",r).val(i);var o=t.data("y_axis_grouping_value");$("#y_axis_grouping_value",r).val(o)})},function(e){oe(e)}),Be=(re=function re(e){var t=$("#mygraphs-table",e);t.length&&t.dataTable({columnDefs:[{targets:0,orderable:!1}],pageLength:50,order:[[1,"asc"]]})},function(e){re(e)}),e=function e(){Ee()},Je=(le=function le(){var n=$("body").data("layout-identifier");$("#views_other_user_typeahead").typeahead({delay:500,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){$("#views_other_user_id").val(e.id)},source:function(e,t){return $.ajax({type:"GET",url:"/"+n+"/match/user/",data:{q:e},success:function(e){t(e)},dataType:"json"})}})},function(e){le()}),Me=function Me(){Je()},He=function He(){$(".globe").each(function(){Re($(this))}),Je()},ze=(ce=function ce(){return{bar:{renderer:$.jqplot.BarRenderer,rendererOptions:{shadow:!1,fillToZero:!0,barMinWidth:10},pointLabels:{show:!1,hideZeros:!0}},donut:{renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,showDataLabels:!0,dataLabels:"value",shadow:!1}},pie:{renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",shadow:!1}},"default":{pointLabels:{show:!1}}}},de=function de(e,t){var n=e.xlabels,a={},i="line"==t.type;a.highlighter={showMarker:i,tooltipContentEditor:function(e,t,n,a){return a._plotData[t][n][1]}};var o=ce();t.type in o?a.seriesDefaults=o[t.type]:a.seriesDefaults=o["default"],"donut"!=t.type&&"pie"!=t.type&&(a.series=e.labels,a.axes={xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:n,label:t.x_axis_name,labelRenderer:$.jqplot.CanvasAxisLabelRenderer},yaxis:{label:t.y_axis_label,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},e.options.y_max&&(a.axes.yaxis.max=e.options.y_max),e.options.is_metric&&(a.axes.yaxis.tickOptions={formatString:"%d%"}),a.axesDefaults={tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:"8pt"}}),a.stackSeries=t.stackseries,a.legend={renderer:$.jqplot.EnhancedLegendRenderer,show:t.showlegend,location:"e",placement:"outside"},$.jqplot("chartdiv".concat(t.id),e.points,a)},se=function se(e){var t=null;return $.ajax({async:!1,url:e,dataType:"json",success:function(e){t=e}}),t},ue=function ue(e){ve(),$.jqplot.config.enablePlugins=!0,e.each(function(e,t){var n=$(t).data(),a=(new Date).getTime(),i="/".concat(n.layoutId,"/data_graph/").concat(n.graphId,"/").concat(a),o=se(i),r={type:n.graphType,x_axis_name:n.xAxisName,y_axis_label:n.yAxisLabel,stackseries:n.stackseries,showlegend:n.showlegend,id:n.graphId};de(o,r)})},fe=function fe(e){var t=$("#chartdiv",e),n=$("[id^=chartdiv]",e);!t.length&&n.length&&ue(n)},function(e){$(document).ready(function(){fe(e)})}),Ge=function Ge(e){Je(),ze(e)},Ue=(pe=function pe(e){$(".table tr[data-href]",e).on("click",function(){window.location=$(this).data("href")})},function(e){pe(e)}),We=function We(){Ue(),Je(),$("#modal_sendemail").on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("peopcol_id");$("#modal_sendemail_peopcol_id").val(t)}),$("#data-table").floatThead({floatContainerCss:{},zIndex:function(){return 999},ariaLabel:function(e,t){return t.data("thlabel")}}),FontDetect.isFontLoaded("14px/1 FontAwesome")||($(".use-icon-font").hide(),$(".use-icon-png").show()),$("#rows_per_page").on("change",function(){this.form.submit()})},Ve=(he=function he(e){var t=e||document;tippy(t.querySelectorAll(".vis-foreground"),{target:".timeline-tippy",theme:"light",onShown:function(){$(".moreinfo",e).off("click").on("click",function(e){var t=$(e.target).data("record-id"),n=$("#readmore_modal");n.find(".modal-body").text("Loading..."),n.find(".modal-body").load("/record_body/"+t),n.modal()})}})},function(e){he(e)});var Qe,Ze,Ke,Ye,Xe,et,tt,nt,at,it,ot,rt,lt,ct,dt,st,ut,ft,pt,ht,mt,vt,gt,$t,bt,yt,_t,wt=function wt(e){e.forEach(function(e){var t,n,a,i,o,r,l;!e.style||"string"!=typeof e.style||(t=e.style.match(/background-color:\s(#[0-9A-Fa-f]{6})/))&&t[1]&&(n=t[1],"dark"==(i=+("0x"+(a=n).slice(1).replace(a.length<5&&/./g,"$&$&")),o=i>>16,r=i>>8&255,l=255&i,150<Math.sqrt(o*o*.299+r*r*.587+l*l*.114)?"light":"dark")&&(e.style=e.style+"; color: #FFFFFF"))})},kt=function kt(l,e){var t=l.data("records"),n=base64.decode(t),a=JSON.parse(n);wt(a);var i,c=new vis.DataSet(a),o=l.data("groups"),r=base64.decode(o),o=JSON.parse(r),d=!!l.data("dashboard"),s=$("body").data("layout-identifier"),u={margin:{item:{horizontal:-1}},moment:(i=function(e){return moment(e).utc()},f.toString=function(){return i.toString()},f),clickToUse:d,zoomFriction:10,template:Handlebars.templates.timelineitem,orientation:{axis:"both"}};function f(e){return i.apply(this,arguments)}for(var p in e)u[p]=e[p];l.data("min")&&(u.start=l.data("min")),l.data("max")&&(u.end=l.data("max")),l.data("width")&&(u.width=l.data("width")),l.data("height")&&(u.width=l.data("height")),l.data("rewind")||(u.editable={add:!1,updateTime:!0,updateGroup:!1,remove:!1},u.multiselect=!0);var h,m,v=new vis.Timeline(l.get(0),c,u);0<o.length&&v.setGroups(o),v.on("rangechanged",function(e){return e.byUser?(e.start.getTime()>m&&e.end.getTime()<h||(l.prev("#loading-div").show(),t=c.min("start"),n=(t=c.max("start"))?new Date(t.start):undefined,(a=(t=c.min("end"))?new Date(t.end):undefined)&&!t.has_time&&a.setDate(a.getDate()-1),t=c.max("end"),i=(t=c.min("single"))?new Date(t.single):undefined,o=(t=c.max("single"))?new Date(t.single):undefined,(r={}).min=a&&i?a<i?a:i:a||i,r.max=n&&o?o<n?n:o:n||o,r.min||y(e.start.getTime(),e.end.getTime()),e.start<r.min&&y(e.start.getTime(),r.min.getTime(),"to"),e.end>r.max&&y(r.max.getTime(),e.end.getTime(),"from"),(!h||h<e.end.getTime())&&(h=e.end.getTime()),(!m||m>e.start.getTime())&&(m=e.start.getTime()),l.prev("#loading-div").hide()),void b(e)):(m=m||e.start.getTime(),void(h=h||e.end.getTime()));var t,n,a,i,o,r});var g=$("body").data("csrf-token");function b(e){d||$.post({url:"/"+s+"/data_timeline?",data:"from="+e.start.getTime()+"&to="+e.end.getTime()+"&csrf_token="+g})}function y(e,t,n){var a="/"+s+"/data_timeline/10?from="+e+"&to="+t+"&exclusive="+n;d&&(a=a+"&dashboard=1&view="+l.data("view")),$.ajax({async:!1,url:a,dataType:"json",success:function(e){c.add(e)}})}return $("#tl_group").on("change",function(){$(this).find(":selected").data("fixedvals")?$("#tl_all_group_values_div").show():$("#tl_all_group_values_div").hide()}).trigger("change"),v},xt=function xt(){var i="#submit_button",o={},r=function r(e,t){o[e.id]=e;var n=$(i);n.is(":hidden")&&($(window).bind("beforeunload",function(e){var t="If you leave this page your changes will be lost.";return e&&(e.returnValue=t),t}),n.closest("form").css("display","block"));var a=$("<li>"+e.content+"</li>");return $("#visualization_changes").append(a),t(e)},l=function l(e){var t=e.getUTCFullYear(),n=("0"+(e.getUTCMonth()+1)).slice(-2),a=("0"+e.getUTCDate()).slice(-2);return timeline.moment.utc(""+t+n+a)},e={onMove:r,snap:l},t=kt($(".visualization"),e),n=function n(){var e=_.mapObject(o,function(e){return{column:e.column,current_id:e.current_id,from:e.start.getTime(),to:(e.end||e.start).getTime()}});$(window).off("beforeunload");var t=JSON.stringify(e);$("#changed_data").attr("value",t)};$(i).bind("click",n),$("#cancel_button").bind("click",function(){$(window).off("beforeunload")});var c=$("body").data("layout-identifier"),d=function d(e){var n,t,a=e.items;0==a.length?$(".bulk_href").on("click",function(e){return e.preventDefault(),alert("Please select some records on the timeline first"),!1}):(n=[],$("#delete_ids").empty(),e.items.forEach(function(e){var t=e.replace(/\+.*/,"");n.push("id="+t),$("#delete_ids").append('<input type="hidden" name="delete_id" value="'+t+'">')}),t=n.join("&"),$("#update_href").attr("href","/"+c+"/bulk/update/?"+t),$("#clone_href").attr("href","/"+c+"/bulk/clone/?"+t),$("#count_delete").text(a.length),$(".bulk_href").off())};t.on("select",d),d({items:[]}),Ve(),Je()},Tt=(Qe=function Qe(){var e=$(this),t=e.data("column-id"),n=e.data("is-multivalue"),a=e.find(".tree-widget-container"),i=a.data("field"),o=$("body").data("layout-identifier"),r=a.data("end-node-only"),l=a.data("ids-as-params"),c={core:{check_callback:!0,force_text:!0,themes:{stripes:!0},data:{url:function(){return"/"+o+"/tree"+(new Date).getTime()+"/"+t+"?"+l},data:function(e){return{id:e.id}}}},plugins:[]};n?c.plugins.push("checkbox"):c.core.multiple=!1,a.on("changed.jstree",function(e,n){a.nextAll(".selected-tree-value").remove();var t=a.jstree("get_selected",!0);$.each(t,function(){var e=$('<input type="hidden" class="selected-tree-value" name="'+i+'" value="'+this.id+'" />').insertAfter(a),t=n.instance.get_path(this,"#");e.data("text-value",t)}),0==t.length&&a.after('<input type="hidden" class="selected-tree-value" name="'+i+'" value="" />'),a.trigger("change")}),a.on("select_node.jstree",function(e,t){0!=t.node.children.length&&(r?(a.jstree(!0).deselect_node(t.node),a.jstree(!0).toggle_node(t.node)):n&&a.jstree(!0).open_node(t.node))}),a.jstree(c),a.jstree(!0).settings.checkbox.cascade="undetermined"},Ze=function Ze(e){$('[data-column-type="tree"]',e).filter(function(){return $(this).find(".tree-widget-container").length}).each(Qe)},function(e){Ze(e)}),jt=(Ke=function Ke(){var a=this.condition,i=this.rules,o=this.field;o.data("dependent-not-shown")&&o.hide();var c=function c(r,e){if(0==e.length)return!0;var l=!1;return e.some(function(e){var t=e.dependsOn,n=e.regexp,a=e.is_negative,i=je(t,e.filtered),o=!a;return $.each(i,function(e,t){a?n.test(t)&&(o=1):n.test(t)&&(o=0)}),o||(l=!0),!!r&&("OR"==r?l:(o&&(l=!1),!l))}),l};i.forEach(function(e){var t=e.dependsOn,n=function n(){c(a,i)?o.show():o.hide();var t=o.closest(".panel-group");t.length&&t.find(".linkspace-field").each(function(){var e=!0;if("none"!=$(this).css("display"))return t.show(),e=!1;e&&t.hide()}),o.trigger("change")};0==t.length&&n(),t.on("change",function(){n()})})},Ye=function Ye(r){$("[data-has-dependency]",r).map(function(){var e=$(this).data("dependency"),t=JSON.parse(base64.decode(e)),n=t.rules,a=t.condition,i=jQuery.map(n,function(e){var t=e.operator,n=-1!==t.indexOf("not"),a=-1!==t.indexOf("equal")?new RegExp("^"+e.value+"$","i"):new RegExp(e.value,"i"),i=e.id,o=!1;return e.filtered&&(i=e.filtered,o=!0),{dependsOn:$('[data-column-id="'+i+'"]',r),regexp:a,is_negative:n,filtered:o}});return{field:$(this),condition:a,rules:i}}).each(Ke)},function(e){Ye(e)}),Ct=(Xe=function Xe(e){var t="Please note that any changes will be lost.";return(e=e||window.event)&&(e.returnValue=t),t},et=function et(e){$(".click-to-edit",e).on("click",function(){var e=$(this);this.innerHTML="Edit"===this.innerHTML?"View":"Edit",$(e.data("viewEl")).toggleClass("expanded"),$(e.data("editEl")).toggleClass("expanded"),"View"===this.innerHTML?window.onbeforeunload=Xe:window.onbeforeunload=null}),$(".submit_button").click(function(){window.onbeforeunload=null}),$(".remove-unload-handler").click(function(){window.onbeforeunload=null})},function(e){et(e)}),Ot=(tt=function tt(e){$(".table--zebra",e).each(function(e,t){var n=!0;$(t).children("tbody").children("tr:visible").each(function(e,t){$(t).toggleClass("odd",n),$(t).toggleClass("even",!n),n=!n})})},function(e){tt(e)}),At=(nt=function nt(t){$(".click-to-view-blank",t).on("click",function(){var e="Show blank values"===this.innerHTML;$(".click-to-view-blank-field",t).toggle(e),this.innerHTML=e?"Hide blank values":"Show blank values",Ot(t)})},function(e){nt(e)}),Dt=function Dt(e){var u=".intcalculator";$(".fileupload",e);$(u,e).closest(".form-group").find("label").each(function(){var i,c,e=$(this),d=$('<div class="dropdown-menu" id="calculator_div"></div>');d.css({position:"absolute","z-index":1100,display:"none",padding:"10px"}),$("body").append(d),d.append('<form class="form-inline">    <div class="form-group btn-group operator" data-toggle="buttons"></div>    <div class="form-group"><input type="text" placeholder="Number" class="form-control"></input></div>    <div class="form-group">        <input type="submit" value="Calculate" class="btn btn-default"></input>    </div></form>'),$(document).mouseup(function(e){d.is(e.target)||0!==d.has(e.target).length||d.hide()});var o=[{action:"add",subvaluelabel:"+",keypress:["+"],operation:function(e,t){return e+t}},{action:"subtract",label:"-",keypress:["-"],operation:function(e,t){return e-t}},{action:"multiply",label:"×",keypress:["*","X","x","×"],operation:function(e,t){return e*t}},{action:"divide",label:"÷",keypress:["/","÷"],operation:function(e,t){return e/t}}],r={},l=d.find(".operator");for(var s in o)!function(){var e=o[s],t=$('<label class="btn btn-primary" style="width:40px"><input type="radio" name="op" class="btn_label_'+e.action+'">'+e.label+"</input></label>");for(var n in l.append(t),t.on("click",function(){i=e.operation,d.find(":text").focus()}),e.keypress){var a=e.keypress[n];r[a]=e.action}}();d.find(":text").on("keypress",function(e){var t,n=e.key;n in r&&(t=".btn_label_"+r[n],d.find(t).click(),e.preventDefault())}),d.find("form").on("submit",function(e){var t=i(+c.val(),+d.find(":text").val());c.val(t),d.hide(),e.preventDefault()}),$('<span class="btn-xs btn-link openintcalculator">Calculator</span>').insertAfter(e).on("click",function(e){var t=$(e.target).closest(".form-group"),n=t.find(u),a=t.offset().top,i=t.height(),o=$("#calculator_div").height(),r=o<a?a-o:a+i;d.css({top:r,left:t.offset().left});var l=d.find(":text");l.val(""),d.show(),l.focus(),c=n})})},Lt=function Lt(e){Linkspace.debug("Record edit JS firing"),Tt(e),jt(e),Ct(e),At(e),Dt(e),Ot(e)},St=function St(){$("#is_shared").change(function(){$("#group_id_div").toggle(this.checked)}).change(),$(".date-grouping").change(function(){$("#trend").val()||$("#set_x_axis").find(":selected").data("is-date")?$("#x_axis_date_display").show():$("#x_axis_date_display").hide()}).change(),$("#trend").change(function(){$(this).val()?$("#group_by_div").hide():$("#group_by_div").show()}).change(),$("#x_axis_range").change(function(){"custom"==$(this).val()?$("#custom_range").show():$("#custom_range").hide()}).change(),$("#y_axis_stack").change(function(){"sum"==$(this).val()?$("#y_axis_div").show():$("#y_axis_div").hide()}).change()},qt=(at=function at(e){$(".dtable",e).each(function(){var e=$(this).data("page-length")||10;$(this).dataTable({order:[[1,"asc"]],pageLength:e})})},function(e){at(e)}),Rt=function Rt(e){qt(e),$("#submit").on("click",function(){$(".dtable").DataTable().column(0).nodes().to$().each(function(){var e=$(this).find("input");e.is(":checked")&&$('<input type="hidden" name="graphs">').val(e.val()).appendTo("form")})})},Et=function Et(e,t){var n=e.xlabels,a={},i="line"==t.type;a.highlighter={showMarker:i,tooltipContentEditor:function(e,t,n,a){return a._plotData[t][n][1]}},"bar"==t.type?a.seriesDefaults={renderer:$.jqplot.BarRenderer,rendererOptions:{shadow:!1,fillToZero:!0,barMinWidth:10},pointLabels:{show:!1,hideZeros:!0}}:"donut"==t.type?a.seriesDefaults={renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,showDataLabels:!0,dataLabels:"value",shadow:!1}}:"pie"==t.type?a.seriesDefaults={renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",shadow:!1}}:a.seriesDefaults={pointLabels:{show:!1}},"donut"!=t.type&&"pie"!=t.type&&(a.series=e.labels,a.axes={xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:n,label:t.x_axis_name,labelRenderer:$.jqplot.CanvasAxisLabelRenderer},yaxis:{label:t.y_axis_label,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},e.options.y_max&&(a.axes.yaxis.max=e.options.y_max),e.options.is_metric&&(a.axes.yaxis.tickOptions={formatString:"%d%"}),a.axesDefaults={tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:"8pt"}}),a.stackSeries=t.stackseries,a.legend={renderer:$.jqplot.EnhancedLegendRenderer,show:t.showlegend,location:"e",placement:"outside"},$.jqplot("chartdiv"+t.id,e.points,a)},Pt=window.do_plot_json=function(e,t){e=JSON.parse(base64.decode(e)),t=JSON.parse(base64.decode(t)),Et(e,t)},Nt=function Nt(e){$(document).ready(function(){$(".dashboard-graph",e).each(function(){var e=$(this),t=e.data("plot-data"),n=e.data("plot-options");Pt(t,n)}),$(".visualization",e).each(function(){kt($(this),{})}),$(".globe",e).each(function(){Re($(this))}),Ve(e)})},It=function It(){var e=$(this),o=e.find('[role="tab"]'),r=e.find('[role="tabpanel"]'),l=[];o.each(function(e){l[e]=$(this),$(this).data("index",e)});var c=function c(e){e&&e.preventDefault();var t=$(this);if("true"===t.attr("aria-selected"))return!1;var n=r.filter(t.attr("href")),a=o.filter('[aria-selected="true"]'),i=r.filter(".active");return a.attr("aria-selected",!1),i.removeClass("active"),t.attr("aria-selected",!0),n.addClass("active"),t.attr("tabindex","0"),o.filter('[aria-selected="false"]').attr("tabindex","-1"),!1},d=function d(e){var t,n=$(this).data("index"),a=e.keyCode,i=Linkspace.constants.ARROW_LEFT,o=Linkspace.constants.ARROW_RIGHT;[i,o].indexOf(a)<0||(a===i&&(t=l[n-1])||a===o&&(t=l[n+1]))&&(c.call(t),t.focus())};o.on("click",c),o.on("keyup",d),o.filter('[aria-selected="false"]').attr("tabindex","-1")},Ft=function Ft(e){$(".tab-interface").each(It);var i=$("#permission-configuration"),t=$(".permission-rule",e),o=$("#permission-rule-template"),n=t.find("button.cancel-permission"),a=t.find("button.add-permission"),r=function r(){i.find("input").each(function(){$(this).prop("checked",!1)}),i.attr("hidden",""),$("#configure-permissions").removeAttr("hidden").focus()},l=function l(){var n=$(this),e=n.data("group-id"),t=n.find("button.edit"),a=n.find("button.delete"),i=n.find("button.ok");n.find("input").on("change",function(){var e="permission-"+$(this).data("permission-class"),t=$(this).prop("checked");n.toggleClass(e,t),t||$(this).siblings("div").find("input").each(function(){$(this).prop(t),e="permission-"+$(this).data("permission-class"),n.toggleClass(e,t)})}),t.on("expand",function(){n.addClass("edit"),n.find(".group-name").focus()}),a.on("click",function(){$("#permissions").removeClass("permission-group-"+e),n.remove()}),i.on("click",function(){n.removeClass("edit"),i.parent().removeClass("expanded"),t.attr("aria-expanded",!1).focus()})};n.on("click",r),a.on("click",function(){var n=$(o.html()),e=$("#current-permissions ul"),t=i.find("option:selected"),a=t.val();i.find("input").each(function(){var e=$(this),t=e.prop("checked");t&&n.addClass("permission-"+e.data("permission-class").replace(/_/g,"-")),n.find("input#"+e.attr("id")).prop("checked",t).attr("id",e.attr("id")+a).attr("name",e.attr("name")+a).next("label").attr("for",e.attr("id"))}),n.appendTo(e),n.attr("data-group-id",a),$("#permissions").addClass("permission-group-"+a),n.find(".group-name").text(t.text()),n.find("button.edit").on("click",_e),l.call(n),r()}),$("#configure-permissions").on("click",function(){var t=$("#permissions"),n=!1;$("#permission-configuration").find("option").each(function(){var e=$(this);e.removeAttr("disabled"),t.hasClass("permission-group-"+e.val())?e.attr("disabled",""):n||(e.attr("selected",""),n=!0)}),$(this).attr("hidden",""),$("#permission-configuration").removeAttr("hidden"),$(this).parent().find("h4").focus()}),$("#current-permissions .permission").each(l)},Bt=function Bt(){$(".remember-me").each(function(){var t=$(this).find("input:checkbox");t.on("change",function(){var e=t.is(":checked");t.toggleClass("remember--checked",e)})}),$(".show-password").each(function(){var t=$(this).find("input:checkbox"),n=document.querySelector("input[name=password]");t.on("change",function(){var e=t.is(":checked");t.toggleClass("show_password--checked",e),n.type=e?"text":"password"})})},Jt=function Jt(){$("#modal_metric").on("show.bs.modal",function(e){var t=$(e.relatedTarget),n=t.data("metric_id");$("#metric_id").val(n),n?$("#delete_metric").show():$("#delete_metric").hide();var a=t.data("target_value");$("#target_value").val(a);var i=t.data("x_axis_value");$("#x_axis_value").val(i);var o=t.data("y_axis_grouping_value");$("#y_axis_grouping_value").val(o)})},Mt=function Mt(){$("#selectall").click(function(){$(".record_selected").prop("checked",this.checked)})},Ht=function Ht(){Ee()},zt=function zt(e){qt(e),$(document).on("click",".cloneme-user",function(){var e=$(this).parents(".limit-to-view");e.clone().removeAttr("id").insertAfter(e)}),$(document).on("click",".removeme-user",function(){var e=$(this).parents(".limit-to-view");0<e.siblings(".limit-to-view").length&&e.remove()})},Gt=(it={config:e,data_calendar:Me,data_globe:He,data_graph:Ge,data_table:We,data_timeline:xt,edit:Lt,graph:St,graphs:Rt,index:Nt,layout:Ft,login:Bt,metric:Jt,purge:Mt,system:Ht,user:zt},ot=function ot(e){var t,n=$("body").data("page").match(/^(.*?)(:?\/\d+)?$/);null===n||(t=it[n[1]])!==undefined&&t(e)},function(e){ot(e)}),Ut=(rt=function rt(e){$("input, text",e).placeholder()},function(e){rt(e)}),Wt=(lt=function lt(e){$('[data-toggle="popover"]',e).popover({placement:"auto",html:!0})},function(e){lt(e)}),Vt=(ct=function ct(e){$("#selectall",e).click(function(){$(".record_selected",e).prop("checked",this.checked)})},function(e){ct(e)}),Qt=(dt=function dt(e){$(".record-popup",e).on("click",function(){var e=$(this).data("record-id"),t=$("#readmore_modal"),n=t.find(".modal-body");n.text("Loading..."),n.load("/record_body/"+e,null,function(){Ot(n)}),t.modal(),event.stopPropagation()})},function(e){dt(e)}),Zt=(st=function st(e){$(".edit-form",e).on("submit",function(){var e=$(document.activeElement);e.prop("disabled",!0),e.prop("name")&&e.after('<input type="hidden" name="'+e.prop("name")+'" value="'+e.val()+'" />')})},function(e){st(e)}),Kt=(ut=function ut(e){$("#modal_sendemail",e).on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("peopcol_id");$("#modal_sendemail_peopcol_id").val(t)})},ft=function ft(i){$("#modal_helptext",i).on("show.bs.modal",function(e){var t=$(e.relatedTarget),n=t.data("col_name");$("#modal_helptext",i).find(".modal-title").text(n);var a=t.data("col_id");$.get("/helptext/"+a,function(e){$("#modal_helptext",i).find(".modal-body").html(e)})})},pt=function pt(e){$("#data-table",e).length&&$("#data-table",e).floatThead({floatContainerCss:{},zIndex:function(){return 999},ariaLabel:function(e,t){return t.data("thlabel")}})},function(e){ut(e),ft(e),pt(e),ve()}),Yt=(ht=function ht(e){$("#modalnewtitle",e).on("hidden.bs.modal",function(){$("#newtitle",e).val("")}),$("#modalneworganisation",e).on("hidden.bs.modal",function(){$("#neworganisation",e).val("")})},mt=function mt(e){$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".limit-to-view");e.clone().removeAttr("id").insertAfter(e)}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".limit-to-view");0<e.siblings(".limit-to-view").length&&e.remove()})},function(e){ht(e),mt(e)}),Xt=(vt=function vt(t){$(".col_check",t).length&&$("#selectall",t).click(function(e){$(".col_check",t).prop("checked",e.currentTarget.checked)})},gt=function gt(t){$("#global",t).change(function(e){$("#group_id_div",t).toggle(e.currentTarget.checked)}).change()},$t=function $t(e){var t=$("div#sorts",e);t.length&&(t.on("click",".closeme",function(e){$(".request-row").length<1||$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",function(e){$(e.currentTarget).parents(".sort-add").before(t.data("sortrow"))}))},bt=function bt(e){var t=$("div#groups",e);t.length&&(t.on("click",".closeme",function(e){$(".request-row").length&&$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",function(e){$(e.currentTarget).parents(".group-add").before(t.data("grouprow"))}))},yt=function yt(e){var t,n=$("#builder",e);n.length&&n.data("use-json")&&(t=base64.decode(n.data("base-filter")),n.queryBuilder("setRules",JSON.parse(t)))},_t=function _t(t){$("#saveview",t).click(function(){var e=$("#builder",t).queryBuilder("getRules");$("#filter",t).val(JSON.stringify(e,null,2))})},function(e){vt(e),gt(e),$t(e),bt(e),yt(e),_t(e)});window.Linkspace={constants:{ARROW_LEFT:37,ARROW_RIGHT:39},init:function(e){a(e),me(e),ge(e),$e(e),xe(e),De(e),Le(e),Se(e),qe(e),Ee(e),Pe(e),Ne(e),Ie(e),Fe(e),Be(e),Gt(e),Ut(e),Wt(e),Vt(e),Qt(e),Te(e),Zt(e),Kt(e),Yt(e),Xt(e)},debug:function(e){"undefined"!=typeof console&&console.debug&&console.debug("[LINKSPACE]",e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[LINKSPACE]",e)}},window.Linkspace.init()}();
