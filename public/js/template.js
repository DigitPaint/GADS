!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=568)}({568:function(e,t,a){"use strict";a.r(t);const n=e=>{if(!["date","daterange"].includes(e))return;const t=["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_empty","is_not_empty"];return"daterange"===e&&t.push("contain"),t},r=(e,t,a)=>({input:(e,t,a)=>`<input class="typeahead_text" type="text" name="${a}_text">\n    <input class="typeahead_hidden" type="hidden" name="${a}"></input>`,valueSetter:(e,t,a,n,r)=>{e.find(".typeahead_text").val(r.text),e.find(".typeahead_hidden").val(t)},onAfterCreateRuleInput:n=>{var r=$(`#${n.attr("id")} .rule-value-container input[type="text"]`),i=$(`#${n.attr("id")} .rule-value-container input[type="hidden"]`);r.attr("autocomplete","off"),r.typeahead({delay:100,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){"object"==typeof e?i.val(e.id):i.val(e)},source:function(n,r){return $.ajax({type:"GET",url:`/${t}/match/layout/${e}`,data:{q:n,oi:a},success:function(e){r(e)},dataType:"json"})}})}}),i={input:"select",values:{b_red:"Red",c_amber:"Amber",c_yellow:"Yellow",d_green:"Green",a_grey:"Grey",e_purple:"Purple"}},l=[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["datetime","string"]},{type:"not_contains",accept_values:!0,apply_to:["datetime","string"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string","number","datetime"]},{type:"is_not_empty",accept_values:!1,apply_to:["string","number","datetime"]},{type:"changed_after",nb_inputs:1,accept_values:!0,multiple:!1,apply_to:["string","number","datetime"]}],o=e=>{const t=JSON.parse($(e).html());t.filterNotDone&&(window.UpdateFilter=e=>{var t=e.queryBuilder("getRules");$("#filter").val(JSON.stringify(t,null,2))}),$(`#builder${t.builderId}`).queryBuilder({showPreviousValues:t.showPreviousValues,filters:t.filters.map(e=>((e,t)=>({id:t.filterId,label:t.label,type:"string",operators:n(t.type),..."rag"===t.type?i:t.hasFilterTypeahead?r(t.urlSuffix,e.layoutId,t.instanceId):{}}))(t,e)),operators:l,lang:{operators:{changed_after:"changed on or after"}}})},d=e=>{$(document,e).on("input",".typeahead_text",function(){var e=$(this).val();$(this).next(".typeahead_hidden").val(e)})};const s=()=>{window.FontDetect&&(FontDetect.isFontLoaded("14px/1 FontAwesome")||($(".use-icon-font").hide(),$(".use-icon-png").show()))},c=e=>{var t=$("#calendar",e);if(!t.length)return!1;var a={events_source:`/${t.attr("data-event-source")}/data_calendar/${(new Date).getTime()}`,view:t.data("view"),tmpl_path:"/tmpls/",tmpl_cache:!1,onAfterEventsLoad:function(e){if(e){var t=$("#eventlist");t.html(""),$.each(e,function(e,a){$(document.createElement("li")).html(`<a href="${a.url}">${a.title}</a>`).appendTo(t)})}},onAfterViewLoad:function(e){$("#caltitle").text(this.getTitle()),$(".btn-group button").removeClass("active"),$(`button[data-calendar-view="${e}"]`).addClass("active")},classes:{months:{general:"label"}}};const n=t.data("calendar-day-ymd");return n&&(a.day=n),t.calendar(a)},u=(e,t)=>{$(".btn-group button[data-calendar-nav]",t).each(function(){var t=$(this);t.click(function(){e.navigate(t.data("calendar-nav"))})}),$(".btn-group button[data-calendar-view]",t).each(function(){var t=$(this);t.click(function(){e.view(t.data("calendar-view"))})})},p=(e,t)=>{$("#first_day",t).change(function(){var t=$(this).val();t=t.length?parseInt(t):null,e.setOptions({first_day:t}),e.view()}),$("#language",t).change(function(){e.setLanguage($(this).val()),e.view()}),$("#events-in-modal",t).change(function(){var t=$(this).is(":checked")?$(this).val():null;e.setOptions({modal:t})}),$("#events-modal .modal-header, #events-modal .modal-footer",t).click(function(){})};var v=e=>{const t=c(e);t&&(u(t,e),p(t,e),s())};const m=(e,t)=>{e.find(".alert").text(t).removeAttr("hidden"),e.parents(".modal-content").get(0).scrollIntoView(),e.find("button[type=submit]").prop("disabled",!1)},f=e=>{$(document,e).on("mousedown",".curval-modal",function(t){var a,n=$(t.target).data("layout-id"),r=$(t.target).data("instance-name"),i=$(t.target).data("current-id"),l=$(t.target).closest(".curval_item").find(`input[name=field${n}]`),o=l.val(),d=l.length?"edit":"add";"edit"===d&&((a=l.data("guid"))||(a=window.guid(),l.attr("data-guid",a)));var s=$("#curval_modal",e);s.find(".modal-body").text("Loading...");var c=i?`/record/${i}`:`/${r}/record/`;s.find(".modal-body").load(`${c}?include_draft&modal=${n}&${o}`,function(){"edit"===d&&s.find("form").data("guid",a),Linkspace.init(s)}),s.on("focus",".datepicker",function(){$(this).datepicker({format:s.attr("data-dateformat-datepicker"),autoclose:!0})}),s.modal()})},h=e=>{$("#curval_modal",e).on("submit",".curval-edit-form",function(e){e.preventDefault();var t=$(this),a=t.serialize();t.addClass("edit-form--validating"),t.find(".alert").attr("hidden",""),$.post(t.attr("action")+"?validate&include_draft",a,function(e){if(0===e.error)((e,t,a)=>{var n=e.serialize(),r=e.data("modal-field-ids"),i=e.data("curval-id"),l=e.data("instance-name"),o=e.data("guid"),d=$("<input>",a).attr({type:"hidden",name:"field"+i,value:n}),s=$("div[data-column-id="+i+"]",a),c=s.data("value-selector");if("noshow"===c){var u=$('<tr class="curval_item">',a);jQuery.map(r,function(n){var r=e.find('[data-column-id="'+n+'"]'),i=getFieldValues(r);i=t["field"+n],i=$("<div />",a).text(i).html(),u.append($('<td class="curval-inner-text">',a).append(i))});var p=$(`<td>\n      <a class="curval-modal" style="cursor:pointer" data-layout-id="${i} data-instance-name=${l}>edit</a> | <a class="curval_remove" style="cursor:pointer">remove</a>\n    </td>`,a);if(u.append(p.append(d)),o)$('input[data-guid="'+o+'"]',a).val(n).closest(".curval_item").replaceWith(u);else $(`#curval_list_${i}`,a).find("tbody").append(u)}else if("dropdown"===c){var v=s.find(".select-widget").first().hasClass("multi"),m=s.find(".current [data-list-item]"),f=s.find(".current .search"),h=s.find(".available");v||(m.attr("hidden",""),h.find("li input").prop("checked",!1));var g=jQuery.map(r,function(e){var a=t["field"+e];return $("<div />").text(a).html()}).join(", ");const e=`field${i}_${o=window.guid()}`;var _=v?'<button class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"";f.before(`<li data-list-item="${e}">${g}${_}</li>`);var y=v?"checkbox":"radio";h.append(`<li class="answer">\n      <span class="control">\n          <label id="${e}_label" for="${e}">\n              <input id="${e}" name="field${i}" type="${y}" value="${n}" class="${v?"":"visually-hidden"}" checked aria-labelledby="${e}_label">\n              <span>${g}</span>\n          </label>\n      </span>\n      <span class="details">\n          <a class="curval_remove" style="cursor:pointer">remove</a>\n      </span>\n    </li>`),setupSelectWidgets(s)}else if("typeahead"===c){var b=s.find(`input[name=field${i}]`),w=s.find(`input[name=field${i}_typeahead]`),k=jQuery.map(r,function(e){var a=t["field"+e];return $("<div />").text(a).html()}).join(", ");b.val(n),w.val(k)}$(".modal.in",a).modal("hide")})(t,e.values);else{var a=1===e.error?e.message:"Oops! Something went wrong.";m(t,a)}},"json").fail(function(e,a,n){m(t,`Oops! Something went wrong: ${a}: ${n}`)}).always(function(){t.removeClass("edit-form--validating")})})},g=e=>{$(".curval_group",e).on("click",".curval_remove",function(){$(this).closest(".curval_item").remove()}),$(".select-widget",e).on("click",".curval_remove",function(){var e=$(this).closest(".answer").find("input").prop("id");$(this).closest(".select-widget").find(`.current li[data-list-item=${e}]`).remove(),$(this).closest(".answer").remove()})};var _=e=>{f(e),h(e),g(e)};const y=e=>{$(".input-daterange input.from",e).each(function(){$(this).on("changeDate",function(){var e=$(this).parents(".input-daterange").find(".datepicker.to");e.val()||e.datepicker("update",$(this).datepicker("getDate"))})})},b=e=>{$(document,e).on("click",".remove_datepicker",function(){var e=".datepicker"+$(this).data("field");$(e).datepicker("destroy"),alert("Date selector has been disabled for this field")})};var w=e=>{(e=>{$(".datepicker",e).datepicker({format:$(document.body).data("config-dataformat-datepicker"),autoclose:!0})})(e),y(e),b(e)};const k=e=>{$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".input_holder"),t=e.clone();t.removeAttr("id").insertAfter(e),t.find(":text").val(""),t.find(".datepicker").datepicker({format:e.attr("data-dateformat-datepicker"),autoclose:!0})}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".input_holder");e.siblings(".input_holder").length>0&&e.remove()})},x=e=>{$("#helptext_modal",e).on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("load-url");$(this).find(".modal-body").load(t)}),$(document,e).on("click",".more-info",function(t){var a=$(t.target).data("record-id"),n=$("#readmore_modal",e);n.find(".modal-body").text("Loading..."),n.find(".modal-body").load("/record_body/"+a),n.one("show.bs.modal",function(a){a.isDefaultPrevented()||n.one("hidden.bs.modal",function(){$(t.target,e).is(":visible")&&$(t.target,e).trigger("focus")})}),n.one("keyup",function(e){27==e.keyCode&&e.stopPropagation()}),n.modal()})},j=e=>{$('input[type="text"][id^="typeahead_"]',e).each((t,a)=>{$(a,e).change(function(){$(this).val()||$(`#${a.id}_value`,e).val("")}),$(a,e).typeahead({delay:500,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(t){$(`#${a.id}_value`,e).val(t.id)},source:function(t,n){return $.ajax({type:"GET",url:`/${$(a,e).data("layout-id")}/match/layout/${$(a).data("typeahead-id")}`,data:{q:t},success:function(e){n(e)},dataType:"json"})}})})};var q=e=>{k(e),x(e),_(e),w(e),j(e)};var T=e=>{(e=>{const t=$("#globe",e);if(t.length){Plotly.setPlotConfig({locale:"en-GB"});var a=JSON.parse(base64.decode(t.attr("data-globe"))),n={showLink:!1,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"],topojsonURL:`${t.attr("data-url")}/`};Plotly.newPlot("globe",a,{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},n)}})(e)};const O=(e,t)=>{var a=e.xlabels,n={},r="line"==t.type;n.highlighter={showMarker:r,tooltipContentEditor:(e,t,a,n)=>n._plotData[t][a][1]};const i=(()=>({bar:{renderer:$.jqplot.BarRenderer,rendererOptions:{shadow:!1,fillToZero:!0,barMinWidth:10},pointLabels:{show:!1,hideZeros:!0}},donut:{renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,showDataLabels:!0,dataLabels:"value",shadow:!1}},pie:{renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",shadow:!1}},default:{pointLabels:{show:!1}}}))();t.type in i?n.seriesDefaults=i[t.type]:n.seriesDefaults=i.default,"donut"!=t.type&&"pie"!=t.type&&(n.series=e.labels,n.axes={xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:a,label:t.x_axis_name,labelRenderer:$.jqplot.CanvasAxisLabelRenderer},yaxis:{label:t.y_axis_label,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},e.options.y_max&&(n.axes.yaxis.max=e.options.y_max),e.options.is_metric&&(n.axes.yaxis.tickOptions={formatString:"%d%"}),n.axesDefaults={tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:"8pt"}}),n.stackSeries=t.stackseries,n.legend={renderer:$.jqplot.EnhancedLegendRenderer,show:t.showlegend,location:"e",placement:"outside"},$.jqplot(`chartdiv${t.id}`,e.points,n)},S=e=>{s(),$.jqplot.config.enablePlugins=!0,e.each((e,t)=>{const a=$(t).data();var n=(new Date).getTime(),r=(e=>{var t=null;return $.ajax({async:!1,url:e,dataType:"json",success:function(e){t=e}}),t})(`/${a.layoutId}/data_graph/${a.graphId}/${n}`),i={type:a.graphType,x_axis_name:a.xAxisName,y_axis_label:a.yAxisLabel,stackseries:a.stackseries,showlegend:a.showlegend,id:a.graphId};O(r,i)})};var R=e=>{(e=>{const t=$("#chartdiv",e),a=$("[id^=chartdiv]",e);!t.length&&a.length&&S(a)})(e)};const C=e=>{$("#related_field_id",e).change(t=>{var a=$(t.currentTarget).find(":selected").data("instance_id");$(".autocur_instance",e).hide(),$(`#autocur_instance_${a}`,e).show()}),$("#filval_related_field_id",e).change(function(){var t=$(this).val();$(".filval_curval",e).hide(),$("#filval_curval_"+t,e).show()})},D=e=>{$("#type",e).on("change",function(){var t=$("#manage-fields",e),a=t.data("column-type"),n=$(this).val();t.removeClass("column-type-"+a),t.addClass("column-type-"+n),t.data("column-type",n),"rag"==n||"intgr"==n||"person"==n?$("#checkbox-multivalue",e).hide():$("#checkbox-multivalue",e).show()}).trigger("change")};var L=e=>{(e=>{$("#btnDeleteNode",e).click(()=>{var t=$("#jstree_demo_div",e).jstree(!0),a=t.get_selected();if(!a.length)return!1;t.delete_node(a)});$("#btnAddNode",e).click(()=>{var t=$("#jstree_demo_div",e).jstree(!0),a=t.get_selected();a=a.length?a[0]:"#",(a=t.create_node(a,{type:"file"}))&&t.edit(a)});$("#btnRenameNode",e).click(()=>{var t=$("#jstree_demo_div",e).jstree(!0),a=t.get_selected();if(!a.length)return!1;a=a[0],t.edit(a)})})(e),(e=>{$("#selectall",e).click(()=>{7==$(".check_perm:checked",e).length?$(".check_perm",e).prop("checked",!1):$(".check_perm",e).prop("checked",!0)})})(e),(e=>{$(".sortable",e).length&&$(".sortable",e).sortable({handle:".drag"})})(e),(e=>{const t=$("#jstree_demo_div",e);t.length&&t.jstree({core:{check_callback:!0,force_text:!0,themes:{stripes:!0},data:{url:()=>`/${t.data("layout-identifier")}/tree${(new Date).getTime()}/${t.data("column-id")}?`,data:e=>({id:e.id})}}})})(e),(e=>{$("div#legs",e).on("click",".add",t=>{$(t.currentTarget,e).closest("#legs").find(".sortable").append('\n        <div class="request-row">\n          <p>\n            <input type="hidden" name="enumval_id">\n            <input type="text" class="form-control" style="width:80%; display:inline" name="enumval">\n            <button type="button" class="close closeme" style="float:none">&times;</button>\n            <span class="fa fa-hand-paper-o fa-lg use-icon-font close drag" style="float:none"></span>\n          </p>\n        </div>\n    '),$(".sortable",e).sortable("refresh")}),$("div#legs").on("click",".closeme",t=>{$(".request-row",e).length<2||$(t.currentTarget,e).parents(".request-row").remove()})})(e),(e=>{$("#refers_to_instance_id",e).change(t=>{var a=`#instance_fields_${$(t.currentTarget,e).val()}`;$(".instance_fields",e).hide(),$(a,e).show()})})(e),C(e),(e=>{$('div[id^="builder"]',e).each((e,t)=>{const a=$(t).data("filter-base");if(a){var n=base64.decode(a);$(t).queryBuilder("setRules",JSON.parse(n))}})})(e),(e=>{const t=$("#displayConditionsBuilder",e);if(!t.length)return;const a=t.data();if(t.queryBuilder({filters:a.filters,allow_groups:0,operators:[{type:"equal",accept_values:!0,apply_to:["string"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"not_equal",accept_values:!0,apply_to:["string"]},{type:"not_contains",accept_values:!0,apply_to:["string"]}]}),a.filterBase){const e=base64.decode(a.filterBase);t.queryBuilder("setRules",JSON.parse(e))}})(e),(e=>{$("#submit_save",e).click(function(){const t=$("#displayConditionsBuilder",e).queryBuilder("getRules");$("#displayConditions",e).val(JSON.stringify(t,null,2));const a=`#builder${$("#refers_to_instance_id",e).val()}`,n=$("#jstree_demo_div",e);if(n.length&&n.is(":visible")){const e=n.jstree(!0).get_json("#",{flat:!1}),t=JSON.stringify(e),a=n.data();return $.ajax({async:!1,type:"POST",url:`/${a.layoutIdentifier}/tree/${a.columnId}`,data:{data:t,csrf_token:a.csrfToken}}).done(()=>{alert("Tree has been updated")}),!0}return $(a,e).is(":visible")&&UpdateFilter($(a,e)),!0})})(e),D(e)};const A=(e,t)=>{const a=$(e,t);a.data("open-on-load")&&a.modal("show")};var P=e=>{A("#modalregister",e),A("#modal-reset-password",e)};var B=e=>{(e=>{const t=$("#modal_metric",e);t.length&&t.on("show.bs.modal",t=>{var a=$(t.relatedTarget),n=a.data("metric_id");$("#metric_id",e).val(n),n?$("#delete_metric",e).show():$("#delete_metric",e).hide();var r=a.data("target_value");$("#target_value",e).val(r);var i=a.data("x_axis_value");$("#x_axis_value",e).val(i);var l=a.data("y_axis_grouping_value");$("#y_axis_grouping_value",e).val(l)})})(e)};var N=e=>{(e=>{const t=$("#mygraphs-table",e);t.length&&t.dataTable({columnDefs:[{targets:0,orderable:!1}],pageLength:50,order:[[1,"asc"]]})})(e)};var I=e=>{(e=>{$("input, text",e).placeholder()})(e)};var J=e=>{(e=>{$('[data-toggle="popover"]',e).popover({placement:"auto",html:!0})})(e)};const F=e=>{$("#selectall",e).click(function(){$(".record_selected",e).prop("checked",this.checked)})};var M=e=>{F(e)};var E=e=>{(e=>{$("#modal_sendemail",e).on("show.bs.modal",e=>{var t=$(e.relatedTarget).data("peopcol_id");$("#modal_sendemail_peopcol_id").val(t)})})(e),(e=>{$("#modal_helptext",e).on("show.bs.modal",t=>{var a=$(t.relatedTarget),n=a.data("col_name");$("#modal_helptext",e).find(".modal-title").text(n);var r=a.data("col_id");$.get("/helptext/"+r,t=>{$("#modal_helptext",e).find(".modal-body").html(t)})})})(e),(e=>{$("#data-table",e).length&&$("#data-table",e).floatThead({floatContainerCss:{},zIndex:()=>999,ariaLabel:(e,t)=>t.data("thlabel")})})(e),s()};var G=e=>{};const V=e=>{$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".limit-to-view");e.clone().removeAttr("id").insertAfter(e)}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".limit-to-view");e.siblings(".limit-to-view").length>0&&e.remove()})};var z=e=>{(e=>{$("#modalnewtitle",e).on("hidden.bs.modal",()=>{$("#newtitle",e).val("")}),$("#modalneworganisation",e).on("hidden.bs.modal",()=>{$("#neworganisation",e).val("")})})(e),V(e)};var Q=e=>{(e=>{$(".col_check",e).length&&$("#selectall",e).click(t=>{$(".col_check",e).prop("checked",t.currentTarget.checked)})})(e),(e=>{$("#global",e).change(t=>{$("#group_id_div",e).toggle(t.currentTarget.checked)}).change()})(e),(e=>{const t=$("div#sorts",e);t.length&&(t.on("click",".closeme",e=>{$(".request-row").length<1||$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",e=>{$(e.currentTarget).parents(".sort-add").before(t.data("sortrow"))}))})(e),(e=>{const t=$("div#groups",e);t.length&&(t.on("click",".closeme",e=>{$(".request-row").length&&$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",e=>{$(e.currentTarget).parents(".group-add").before(t.data("grouprow"))}))})(e),(e=>{const t=$("#builder",e);if(t.length&&t.data("use-json")){var a=base64.decode(t.data("base-filter"));t.queryBuilder("setRules",JSON.parse(a))}})(e),(e=>{$("#saveview",e).click(()=>{var t=$("#builder",e).queryBuilder("getRules");$("#filter",e).val(JSON.stringify(t,null,2))})})(e)};var U;(e=>{(e=>{$('script[id^="builder_json_"]',e).each((e,t)=>{o(t)})})(e),d(e)})(U),v(U),q(U),T(U),R(U),L(U),P(U),B(U),N(U),I(U),J(U),M(U),E(U),G(U),z(U),Q(U)}});
//# sourceMappingURL=template.js.map